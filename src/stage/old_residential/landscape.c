#include "entity.h"
#include "global.h"
#include "overworld.h"
#include "solid.h"

#define WIDTH 32
#define HEIGHT 18

static const u8 u8_ARRAY_0833dfac[9][2];
static const u8 u8_ARRAY_0833dfbe[14][2];

static void initOldLifeSpace(struct Coord* _ UNUSED);
static void oldLifeSpace_0800dbc4(struct Coord* _ UNUSED);
static void FUN_0800dc6c(struct Coord* _ UNUSED);
static void exitOldLifeSpace(struct Coord* _ UNUSED);

static const StageFunc sStageRoutine[4] = {
    initOldLifeSpace,
    oldLifeSpace_0800dbc4,
    FUN_0800dc6c,
    exitOldLifeSpace,
};

static void initOldLifeSpace(struct Coord* _ UNUSED) {
  gOverworld.work.oldLifeSpace.leaf = NULL;
  gOverworld.work.oldLifeSpace.unk_004[0] = 0;
  gOverworld.work.oldLifeSpace.unk_008 = 0;
  gOverworld.work.oldLifeSpace.unk_00a = 0;
  gOverworld.work.oldLifeSpace.unk_00c = 0;
  gOverworld.work.oldLifeSpace.unk_010 = 0;
  gOverworld.work.oldLifeSpace.unk_012 = 0;
}

static void oldLifeSpace_0800dbc4(struct Coord* _ UNUSED) {
  if (gOverworld.work.oldLifeSpace.leaf == NULL) {
    gOverworld.work.oldLifeSpace.leaf = CreateLeafBurn(0);
  }

  if ((gOverworld.unk_1c8.tilesets[0] >> 8 == STAGE_OLD_RESIDENTIAL) && ((gOverworld.unk_1c8.tilesets[0] & 0xFF) == 0)) {
    gOverworld.work.oldLifeSpace.unk_008++;
    if (gOverworld.work.oldLifeSpace.unk_008 == 132) {
      gOverworld.work.oldLifeSpace.unk_008 = 0;
      gOverworld.work.oldLifeSpace.unk_00a = 0;
    }

    gOverworld.work.oldLifeSpace.unk_00c++;
    if (gOverworld.work.oldLifeSpace.unk_00c == 48) {
      gOverworld.work.oldLifeSpace.unk_00c = 0;
    }

    gOverworld.work.oldLifeSpace.unk_00c++;
    if (gOverworld.work.oldLifeSpace.unk_00c == 60) {
      gOverworld.work.oldLifeSpace.unk_00c = 0;
    }

    gOverworld.work.oldLifeSpace.unk_010++;
    if (gOverworld.work.oldLifeSpace.unk_010 == 183) {
      gOverworld.work.oldLifeSpace.unk_010 = 0;
      gOverworld.work.oldLifeSpace.unk_012 = 0;
    }
  }
}

static void FUN_0800dc6c(struct Coord* _ UNUSED) {
  if ((gOverworld.unk_1c8.tilesets[0] >> 8 == STAGE_OLD_RESIDENTIAL) && ((gOverworld.unk_1c8.tilesets[0] & 0xFF) == 0)) {
    while (gOverworld.work.oldLifeSpace.unk_008 >= u8_ARRAY_0833dfac[gOverworld.work.oldLifeSpace.unk_00a][1]) {
      gOverworld.work.oldLifeSpace.unk_00a++;
    }

    RequestGraphicTransfer(&(TILESETS(18, 42)[u8_ARRAY_0833dfac[gOverworld.work.oldLifeSpace.unk_00a][0]]).g, (void*)0x4000);
    LoadPalette(&(TILESETS(18, 42)[u8_ARRAY_0833dfac[gOverworld.work.oldLifeSpace.unk_00a][0]]).pal, 0);

    RequestGraphicTransfer(&(TILESETS(18, 47)[gOverworld.work.oldLifeSpace.unk_00c / 12]).g, (void*)0x4000);
    LoadPalette(&(TILESETS(18, 47)[gOverworld.work.oldLifeSpace.unk_00c / 12]).pal, 0);

    RequestGraphicTransfer(&(TILESETS(18, 51)[gOverworld.work.oldLifeSpace.unk_00c / 12]).g, (void*)0x4000);
    LoadPalette(&(TILESETS(18, 51)[gOverworld.work.oldLifeSpace.unk_00c / 12]).pal, 0);

    while (gOverworld.work.oldLifeSpace.unk_010 >= u8_ARRAY_0833dfbe[gOverworld.work.oldLifeSpace.unk_012][1]) {
      gOverworld.work.oldLifeSpace.unk_012++;
    }
    RequestGraphicTransfer(&(TILESETS(18, 56)[u8_ARRAY_0833dfbe[gOverworld.work.oldLifeSpace.unk_012][0]]).g, (void*)0x4000);
    LoadPalette(&(TILESETS(18, 56)[u8_ARRAY_0833dfbe[gOverworld.work.oldLifeSpace.unk_012][0]]).pal, 0);
  }
}

static void exitOldLifeSpace(struct Coord* _ UNUSED) {
  struct Solid* leaf = gOverworld.work.oldLifeSpace.leaf;
  if (leaf != NULL) {
    (leaf->s).flags &= ~DISPLAY;
    (leaf->s).flags &= ~FLIPABLE;
    (leaf->body).status = 0;
    (leaf->body).prevStatus = 0;
    (leaf->body).invincibleTime = 0;
    (leaf->s).flags &= ~COLLIDABLE;
    SET_SOLID_ROUTINE(leaf, ENTITY_DISAPPEAR);
  }
}

// ------------------------------------------------------------------------------------------------------------------------------------

static void FUN_0800de98(struct StageLayer* l, const struct Stage* _ UNUSED);
void FUN_0800decc(struct StageLayer* l, const struct Stage* stage);
void FUN_0800dfa4(struct StageLayer* l, const struct Stage* stage);
void FUN_0800dfec(struct StageLayer* l, const struct Stage* stage);
void FUN_0800e030(struct StageLayer* l, const struct Stage* stage);
void FUN_0800e0cc(struct StageLayer* l, const struct Stage* stage);
void ctrlOLSBG3Scroll(struct StageLayer* l, const struct Stage* stage);
void FUN_0800e1f8(struct StageLayer* l, const struct Stage* stage);
void FUN_0800e22c(struct StageLayer* l, const struct Stage* stage);
void FUN_0800e250(struct StageLayer* l, const struct Stage* stage);

// clang-format off
static const StageLayerRoutine sLayerRoutine[10] = {
    [0] = {NULL, NULL, NULL},
    [1] = {NULL, DrawGeneralStageLayer, NULL},
    [2] = {FUN_0800de98, FUN_0800decc, NULL},
    [3] = {FUN_0800dfa4, DrawGeneralStageLayer, NULL},
    [4] = {FUN_0800dfec, DrawGeneralStageLayer, NULL},
    [5] = {FUN_0800e030, DrawGeneralStageLayer, NULL},
    [6] = {FUN_0800e0cc, ctrlOLSBG3Scroll, NULL},
    [7] = {FUN_0800e1f8, DrawGeneralStageLayer, NULL},
    [8] = {FUN_0800e22c, DrawGeneralStageLayer, NULL},
    [9] = {FUN_0800e250, DrawGeneralStageLayer, NULL},
};
// clang-format on

static void FUN_0800de98(struct StageLayer* l, const struct Stage* _ UNUSED) {
  if (l->phase == 0) {
    BGCNT16((l->bgIdx << 16) >> 20) = (BGCNT16((l->bgIdx << 16) >> 20) & 0xFFFC) | 1;
    l->phase++;
  }
}

INCASM("asm/stage_gfx/old_residential.inc");

static const struct ScreenLayout sScreenMap1 = {
  realWidth : WIDTH,
  skip : 1,
  width : WIDTH,
  height : HEIGHT,
};
// clang-format off
static const u8 sScreenMapData1[HEIGHT][WIDTH] = {
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x55, 0x6F,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x16, 0x17, 0x18, 0x19, 0x01, 0x01, 0x01, 0x01, 0x1E, 0x1F, 0x01, 0x01, 0x01, 0x48, 0x1A, 0x1B, 0x1C, 0x1D, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x23, 0x24, 0x25, 0x26, 0x27, 0x28, 0x01, 0x01, 0x01, 0x01, 0x3B, 0x01, 0x2F, 0x01, 0x01, 0x01, 0x29, 0x2A, 0x2B, 0x2C, 0x2D, 0x2E, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0x01, 0x10, 0x11, 0x01, 0x4B, 0x01, 0x3F, 0x01, 0x01, 0x01, 0x39, 0x3A, 0x01, 0x3C, 0x3D, 0x3E, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x20, 0x21, 0x01, 0x5B, 0x01, 0x4F, 0x01, 0xB5, 0x00, 0x49, 0x4A, 0x01, 0x4C, 0x4D, 0x00, 0xB4, 0x00, 0xB2, 0xB3, 0x01, 0x45,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x6B, 0x01, 0x5F, 0x56, 0x57, 0x58, 0x59, 0x5A, 0x01, 0x5C, 0x5D, 0x5E, 0x50, 0x51, 0x52, 0x53, 0x54, 0x55,
  0x01, 0x03, 0x04, 0x01, 0x13, 0x14, 0x01, 0x43, 0x01, 0x67, 0x01, 0x01, 0x01, 0x01, 0x6A, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x6C, 0x6D, 0x6E, 0x60, 0x61, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x69, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0xB8, 0xB9, 0xBA, 0xBB, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7A, 0x7B, 0x7C, 0x00, 0x00, 0x00, 0x7D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0x78, 0x79, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x92, 0x93, 0x94, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x73, 0x74, 0x75, 0x76, 0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xA2, 0xA3, 0xA4, 0x00, 0x00, 0x88, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x70, 0x71, 0x72, 0x83, 0x84, 0x85, 0x86, 0x87, 0x00, 0x00, 0x00, 0xBC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x81, 0x00, 0x96, 0x97, 0x98, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x91, 0x00, 0x95, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7E, 0x7F, 0x00, 0xA0, 0xA1, 0x00, 0xA5, 0x89, 0x8A, 0x8B, 0x8C, 0x8D, 0x8E, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xB7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xA6, 0x99, 0x9A, 0x9B, 0x9C, 0x00, 0x00, 0x00, 0x00,
};
// clang-format on

static const struct ScreenLayout sScreenMap2 = {
  realWidth : WIDTH,
  skip : 1,
  width : WIDTH,
  height : 10,
};
// clang-format off
static const u8 sScreenMapData2[10][WIDTH] = {
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x44, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x8F, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x12,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x22,
  0x01, 0xA7, 0xA8, 0x01, 0xA9, 0xAA, 0x01, 0xAB, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
};
// clang-format on

static const struct ScreenLayout sScreenMap3 = {
  realWidth : WIDTH,
  skip : 1,
  width : WIDTH,
  height : 10,
};
// clang-format off
static const u8 sScreenMapData3[10][WIDTH] = {
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x05, 0x01, 0x62, 0x63, 0x64, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x44,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x15, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x46, 0x47, 0x46, 0x47, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x40, 0x41, 0x42, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x9D, 0x9E, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0xAE, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0xAC, 0xAD, 0x01, 0xB0, 0xB1, 0x01, 0x9F, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
};
// clang-format on

// clang-format off
static const tileset_ofs_t sTilesetOffset[4+(10 * WIDTH)] = {
    5, 31, WIDTH, 10,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x32, 0x32,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x32, 0x32,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x32, 0x32,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x32, 0x32,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x32, 0x32,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x32, 0x32,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x32, 0x32,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x32, 0x32,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x32, 0x32,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x32, 0x32,
};
// clang-format on

// clang-format off
static const u16 u16_ARRAY_0833dca4[4+(10 * WIDTH)] = {
    5, 31, WIDTH, 10,
    0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF125, 0xF125, 0xF125, 0xF125, 0xF125, 0xF125, 0xF180, 0xF180, 0xF120, 0xF120, 0xF120, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100,
    0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF125, 0x1125, 0x0125, 0x1125, 0x0125, 0x0125, 0x4180, 0x2180, 0x0120, 0x0120, 0x0120, 0xF100, 0xF100, 0xF120, 0xF126, 0xF126, 0xF126, 0xF176, 0xF176, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0x2100, 0x0100,
    0xF100, 0xF100, 0xF100, 0xF120, 0xF125, 0xF125, 0xF125, 0x2125, 0x2125, 0x2120, 0x2120, 0xF100, 0xF100, 0xF106, 0xF106, 0xF120, 0x0120, 0xF100, 0xF100, 0xF120, 0x0126, 0x0126, 0x0126, 0x1176, 0x2176, 0xF126, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100,
    0xF125, 0xF125, 0xF125, 0xF125, 0x0125, 0x0125, 0x0125, 0x0125, 0x1125, 0x0120, 0x0120, 0xF129, 0xF129, 0xF106, 0x0106, 0xF120, 0x0120, 0xF100, 0xF100, 0xF120, 0x0126, 0x0126, 0x0126, 0x0126, 0x0126, 0x0126, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100,
    0xF125, 0x0125, 0x0125, 0x0125, 0x0120, 0x0120, 0x0120, 0x0120, 0x0120, 0x0120, 0xF129, 0x0129, 0x0129, 0xF106, 0x0106, 0xF120, 0x0120, 0xF100, 0xF100, 0xF120, 0x1120, 0x2120, 0xF100, 0x2120, 0x2120, 0x1120, 0xF100, 0xF100, 0xF100, 0xF100, 0xF134, 0xF134,
    0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF129, 0x0129, 0x0129, 0xF106, 0x0106, 0xF120, 0x0126, 0xF126, 0xE126, 0xE126, 0xE126, 0x1120, 0xF106, 0x1126, 0xE126, 0xE126, 0xE126, 0xE120, 0xE120, 0xE120, 0xF134, 0x0134,
    0xF111, 0xF111, 0xF111, 0xF111, 0xF111, 0xF111, 0xF111, 0xF111, 0xF129, 0xF129, 0xF100, 0xF100, 0xF100, 0xF106, 0x0106, 0xF120, 0x0126, 0x0126, 0x0126, 0x0126, 0x0126, 0x0120, 0xF106, 0x0126, 0x0126, 0x0126, 0x0126, 0x0120, 0x0120, 0x0120, 0x2134, 0x0134,
    0xF111, 0x0111, 0x0111, 0xF111, 0x0111, 0x0111, 0xF111, 0x0111, 0xF129, 0x0129, 0xF100, 0xF100, 0xF100, 0xF106, 0x0106, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF106, 0x0126, 0x0126, 0x0126, 0x0126, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100,
    0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF106, 0x0106, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100,
    0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100,
};
// clang-format on

const struct Stage gOldLifeSpaceLandscape = {
  id : STAGE_OLD_RESIDENTIAL,
  fn : sStageRoutine,
  terrainHdr : &gStageTerrains[STAGE_OLD_RESIDENTIAL],
  maps : {&sScreenMap1, &sScreenMap2, &sScreenMap3},
  bgIdx : {USE_BG1, USE_BG2, USE_BG3},
  prio : {2, 2, 1},
  screenBase : {BGMAP_BLOCK(2), BGMAP_BLOCK(4), BGMAP_BLOCK(6)},
  scrollPower : {{0x100, 0x100}, {0x100, 0x100}, {0x100, 0x100}},
  scroll : {{0, 0}, {0, 0}, {0, 0}},
  tilesetOffset : sTilesetOffset,
  bgFns : sLayerRoutine,
  behavior : u16_ARRAY_0833dca4,
  unk_78 : {0, 0},
};

// clang-format off
static const u8 u8_ARRAY_0833dfac[9][2] = {
    {0, 6},
    {1, 12},
    {2, 18}, 
    {3, 30}, 
    {4, 60}, 
    {3, 63}, 
    {2, 66}, 
    {1, 69}, 
    {0, 132},
};
// clang-format on

// clang-format off
static const u8 u8_ARRAY_0833dfbe[14][2] = {
    { 0, 3 },
    { 1, 6 },
    { 0, 9 },
    { 1, 69 },
    { 0, 72 },
    { 1, 75 },
    { 0, 78 },
    { 1, 81 },
    { 0, 84 },
    { 1, 87 },
    { 0, 90 },
    { 1, 93 },
    { 0, 96 },
    { 1, 183 },
};
// clang-format on

// --------------------------------------------

const struct MetatilePatch ALIGNED(2) MetatilePatch_0833dfda = {w : 1, h : 1};
const metatile_id_t MetatilePatchData_0833dfda[2] = {0, 0};  // 2nd element is padding

// --------------------------------------------

const struct MetatilePatch ALIGNED(2) MetatilePatch_0833dfe2 = {w : 2, h : 1};
const metatile_id_t MetatilePatchData_0833dfe2[2] = {0x2B1, 0x2B2};

const struct MetatilePatch ALIGNED(2) MetatilePatch_0833dfea = {w : 2, h : 1};
const metatile_id_t MetatilePatchData_0833dfea[2] = {0x264, 0x272};

const struct MetatilePatch ALIGNED(2) MetatilePatch_0833dff2 = {w : 2, h : 1};
const metatile_id_t MetatilePatchData_0833dff2[2] = {0x273, 0x274};

const struct MetatilePatch ALIGNED(2) MetatilePatch_0833dffa = {w : 2, h : 1};
const metatile_id_t MetatilePatchData_0833dffa[2] = {0x30D, 0x30D};

const struct MetatilePatch ALIGNED(2) MetatilePatch_0833e002 = {w : 2, h : 1};
const metatile_id_t MetatilePatchData_0833e002[2] = {0x13B, 0x11E};

const struct MetatilePatch ALIGNED(2) MetatilePatch_0833e00a = {w : 2, h : 1};
const metatile_id_t MetatilePatchData_0833e00a[2] = {0x11F, 0x30A};

// ./tools/dumper/bin.ts ./baserom.gba 0x0833e012 0x0833e138 ./data/landscape_old_residential.bin
INCBIN("data/landscape_old_residential.bin");

#undef WIDTH
#undef HEIGHT
