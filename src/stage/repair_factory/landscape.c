#include "blink.h"
#include "gfx.h"
#include "global.h"
#include "overworld.h"

#define WIDTH 32
#define HEIGHT 10

static void initRepairFactory(struct Coord* _ UNUSED);
static void repairFactory_0800d6b4(struct Coord* c);
static void repairFactory_0800d8c0(struct Coord* _ UNUSED);
static void exitRepairFactory(struct Coord* _ UNUSED);

static const StageFunc sStageRoutine[4] = {
    initRepairFactory,
    repairFactory_0800d6b4,
    repairFactory_0800d8c0,
    exitRepairFactory,
};

static void initRepairFactory(struct Coord* _ UNUSED) {
  gOverworld.unk_1c8.work[0] = 0;
  gOverworld.work.repairFactory.unk_000 = 0;
  gOverworld.work.repairFactory.unk_001 = 0;
  gOverworld.work.repairFactory.unk_002 = 0;
  LoadBlink(0x2B, 0);
  LoadBlink(0x2C, 0);
}

static void repairFactory_0800d6b4(struct Coord* c) {
  if ((gOverworld.unk_1c8.tilesets[1] >> 8 == STAGE_REPAIR_FACTORY) && ((gOverworld.unk_1c8.tilesets[1] & 0xff) == 1)) {
    if ((gOverworld.work.repairFactory.unk_000 & (1 << 0)) == 0) {
      gOverworld.work.repairFactory.unk_000 |= (1 << 0);
      LoadBlink(45, 0);
    }
    GetBlinkMotionState(45);

  } else if (gOverworld.work.repairFactory.unk_000 & (1 << 0)) {
    gOverworld.work.repairFactory.unk_000 ^= (1 << 0);
    ClearBlink(45);
  }

  if ((gOverworld.unk_1c8.tilesets[1] >> 8 == STAGE_REPAIR_FACTORY) && ((gOverworld.unk_1c8.tilesets[1] & 0xff) == 4)) {
    if ((gOverworld.work.repairFactory.unk_000 & (1 << 1)) == 0) {
      gOverworld.work.repairFactory.unk_000 |= (1 << 1);
      LoadBlink(46, 0);
      LoadBlink(47, 0);
      LoadBlink(48, 0);
    }
    GetBlinkMotionState(46);
    GetBlinkMotionState(47);
    GetBlinkMotionState(48);

  } else if (gOverworld.work.repairFactory.unk_000 & (1 << 1)) {
    gOverworld.work.repairFactory.unk_000 ^= (1 << 1);
    ClearBlink(46);
    ClearBlink(47);
    ClearBlink(48);
  }

  GetBlinkMotionState(43);
  GetBlinkMotionState(44);

  if (gOverworld.unk_1c8.work[0] == 0) {
    gOverworld.unk_1c8.unk_2c004.x = -0x155;
    gOverworld.unk_1c8.unk_2c004.y = 0x155;
    gOverworld.work.repairFactory.unk_001++;
    if (gOverworld.work.repairFactory.unk_001 == 6) {
      gOverworld.work.repairFactory.unk_001 = gOverworld.unk_1c8.work[0];
    }
  } else {
    gOverworld.unk_1c8.unk_2c004.x = 0x155;
    gOverworld.unk_1c8.unk_2c004.y = -0x155;
    gOverworld.work.repairFactory.unk_001--;
    if (gOverworld.work.repairFactory.unk_001 < 0) {
      gOverworld.work.repairFactory.unk_001 = 5;
    }
  }

  gOverworld.work.repairFactory.unk_002++;
  if (gOverworld.work.repairFactory.unk_002 == 45) {
    gOverworld.work.repairFactory.unk_002 = 0;
  }

  if ((c->x - 0x10D001U < 0x5AFFF) || ((c->x < 0x1E000 && (c->y < 0x14000)))) {
    if (!isSoundPlaying(SE_UNK_10b)) {
      PlaySound(SE_UNK_10b);
    }
    SetStageNoiseVolume(SE_UNK_10b);
  } else {
    if (isSoundPlaying(SE_UNK_10b)) {
      stopSound(SE_UNK_10b);
    }
  }
}

NAKED static void repairFactory_0800d8c0(struct Coord* _ UNUSED) {
  asm(".syntax unified\n\
	push {r4, r5, r6, r7, lr}\n\
	mov r7, r8\n\
	push {r7}\n\
	ldr r7, _0800D99C @ =gStageTilesetOffsets+(18*4)\n\
	ldr r5, _0800D9A0 @ =gOverworld\n\
	ldr r0, _0800D9A4 @ =0x0002D029\n\
	adds r6, r5, r0\n\
	movs r0, #0\n\
	ldrsb r0, [r6, r0]\n\
	lsls r0, r0, #1\n\
	movs r1, #3\n\
	bl __divsi3\n\
	lsls r1, r0, #2\n\
	adds r1, r1, r0\n\
	lsls r1, r1, #2\n\
	ldr r4, _0800D9A8 @ =0x0870478C\n\
	adds r1, r1, r4\n\
	ldr r0, [r7]\n\
	adds r0, r0, r1\n\
	movs r1, #0x80\n\
	lsls r1, r1, #7\n\
	mov r8, r1\n\
	bl RequestGraphicTransfer\n\
	movs r0, #0\n\
	ldrsb r0, [r6, r0]\n\
	lsls r0, r0, #1\n\
	movs r1, #3\n\
	bl __divsi3\n\
	lsls r1, r0, #2\n\
	adds r1, r1, r0\n\
	lsls r1, r1, #2\n\
	adds r1, r1, r4\n\
	ldr r0, [r7]\n\
	adds r0, r0, r1\n\
	adds r0, #0xc\n\
	movs r1, #0\n\
	bl LoadPalette\n\
	ldr r0, _0800D9AC @ =0x0002D02A\n\
	adds r6, r5, r0\n\
	ldrb r0, [r6]\n\
	movs r1, #9\n\
	bl __udivsi3\n\
	lsls r0, r0, #0x18\n\
	lsrs r0, r0, #0x18\n\
	lsls r1, r0, #2\n\
	adds r1, r1, r0\n\
	lsls r1, r1, #2\n\
	adds r4, #0x50\n\
	adds r1, r1, r4\n\
	ldr r0, [r7]\n\
	adds r0, r0, r1\n\
	mov r1, r8\n\
	bl RequestGraphicTransfer\n\
	ldrb r0, [r6]\n\
	movs r1, #9\n\
	bl __udivsi3\n\
	lsls r0, r0, #0x18\n\
	lsrs r0, r0, #0x18\n\
	lsls r1, r0, #2\n\
	adds r1, r1, r0\n\
	lsls r1, r1, #2\n\
	adds r1, r1, r4\n\
	ldr r0, [r7]\n\
	adds r0, r0, r1\n\
	adds r0, #0xc\n\
	movs r1, #0\n\
	bl LoadPalette\n\
	ldr r1, _0800D9B0 @ =0x000007D6\n\
	adds r5, r5, r1\n\
	ldrh r5, [r5]\n\
	lsrs r0, r5, #8\n\
	cmp r0, #4\n\
	bne _0800D990\n\
	movs r0, #0xff\n\
	ands r0, r5\n\
	cmp r0, #4\n\
	bne _0800D990\n\
	ldr r0, _0800D9B4 @ =gMission\n\
	ldr r0, [r0]\n\
	ldr r0, [r0, #0x14]\n\
	movs r1, #0x40\n\
	ands r0, r1\n\
	cmp r0, #0\n\
	beq _0800D990\n\
	ldr r0, [r7]\n\
	ldr r1, _0800D9B8 @ =0x08704C28\n\
	adds r0, r0, r1\n\
	mov r1, r8\n\
	bl RequestGraphicTransfer\n\
	ldr r0, [r7]\n\
	ldr r1, _0800D9BC @ =0x08704C34\n\
	adds r0, r0, r1\n\
	movs r1, #0\n\
	bl LoadPalette\n\
_0800D990:\n\
	pop {r3}\n\
	mov r8, r3\n\
	pop {r4, r5, r6, r7}\n\
	pop {r0}\n\
	bx r0\n\
	.align 2, 0\n\
_0800D99C: .4byte gStageTilesetOffsets+(18*4)\n\
_0800D9A0: .4byte gOverworld\n\
_0800D9A4: .4byte 0x0002D029\n\
_0800D9A8: .4byte 0x0870478C\n\
_0800D9AC: .4byte 0x0002D02A\n\
_0800D9B0: .4byte 0x000007D6\n\
_0800D9B4: .4byte gMission\n\
_0800D9B8: .4byte 0x08704C28\n\
_0800D9BC: .4byte 0x08704C34\n\
 .syntax divided\n");
}

static void exitRepairFactory(struct Coord* _ UNUSED) {
  ClearBlink(43);
  ClearBlink(44);
  ClearBlink(45);
  ClearBlink(46);
  ClearBlink(47);
  ClearBlink(48);
  if (isSoundPlaying(SE_UNK_10b)) {
    stopSound(SE_UNK_10b);
  }
}

void rfactory_0800da04(struct StageLayer* l, const struct Stage* stage);
void rfactory_0800da80(struct StageLayer* l, const struct Stage* stage);

// clang-format off
static const StageLayerRoutine sLayerRoutine[4] = {
    [0] = {
      [LAYER_UPDATE] = NULL,
      [LAYER_DRAW]   = NULL,
      [LAYER_EXIT]   = NULL,
    },
    [1] = {
      [LAYER_UPDATE] = NULL,
      [LAYER_DRAW]   = DrawGeneralStageLayer,
      [LAYER_EXIT]   = NULL,
    },
    [2] = {
      [LAYER_UPDATE] = rfactory_0800da04,
      [LAYER_DRAW]   = DrawGeneralStageLayer,
      [LAYER_EXIT]   = NULL,
    },
    [3] = {
      [LAYER_UPDATE] = rfactory_0800da80,
      [LAYER_DRAW]   = DrawGeneralStageLayer,
      [LAYER_EXIT]   = NULL,
    },
};
// clang-format on

static const struct ScreenLayout ScreenMap_0833cdf4 = {
  realWidth : WIDTH,
  skip : 1,
  width : WIDTH,
  height : HEIGHT,
};
// clang-format off
static const u8 ScreenMapData_0833cdf8[HEIGHT][WIDTH] = {
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x36, 0x37, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x6F, 0x01, 0x01, 0x01, 0x01, 0x01, 0x0F, 0x11, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x70, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x20, 0x02, 0x01, 0x68, 0x69, 0x27, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1F, 0x01, 0x01, 0x01, 0x01, 0x28, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x0D, 0x0E, 0x10, 0x12, 0x14, 0x15, 0x16, 0x17, 0x18, 0x02, 0x01, 0x02, 0x1E, 0x01, 0x01, 0x01, 0x01, 0x29, 0x02, 0x01, 0x01, 0x01, 0x01, 0x39, 0x3A, 0x01,
    0x01, 0x01, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0F, 0x11, 0x13, 0x65, 0x66, 0x67, 0x02, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x01, 0x01, 0x01, 0x01, 0x2A, 0x2B, 0x2C, 0x2D, 0x32, 0x33, 0x34, 0x35, 0x01,
    0x01, 0x01, 0x07, 0x06, 0x01, 0x64, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x6A, 0x6B, 0x6C, 0x2E, 0x31, 0x02, 0x01, 0x01, 0x01,
    0x01, 0x03, 0x04, 0x05, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x2F, 0x30, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x6D, 0x6E, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x36, 0x37, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
};
// clang-format on

static const struct ScreenLayout ScreenMap_0833cf38 = {
  realWidth : WIDTH,
  skip : 1,
  width : WIDTH,
  height : HEIGHT,
};
// clang-format off
static const u8 ScreenMapData_0833cf3c[HEIGHT][WIDTH] = {
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x71, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x3E, 0x3F, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x5B, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x5C, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x3B, 0x3C, 0x3D, 0x01, 0x01, 0x01, 0x01, 0x01, 0x5D, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x5A, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x4F, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x40, 0x41, 0x42, 0x01, 0x01, 0x01, 0x54, 0x55, 0x01,
    0x01, 0x01, 0x46, 0x47, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x38, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x43, 0x44, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
};
// clang-format on

static const struct ScreenLayout ScreenMap_0833d07c = {
  realWidth : WIDTH,
  skip : 1,
  width : WIDTH,
  height : HEIGHT,
};
// clang-format off
static const u8 ScreenMapData_0833d080[HEIGHT][WIDTH] = {
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x5E, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x5F, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x4E, 0x01, 0x01, 0x01, 0x01, 0x60, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x4A, 0x4B, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x50, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x53, 0x53, 0x53, 0x01, 0x01, 0x56, 0x57, 0x01,
    0x01, 0x01, 0x48, 0x49, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
};
// clang-format on

// clang-format off
static const tileset_ofs_t sTilesetOffset[4+(HEIGHT * WIDTH)] = {
    5, 31, WIDTH, HEIGHT,
    0x01, 0x01, 0x02, 0x02, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 0x04, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x04, 0x04, 0x04, 0x04,
    0x01, 0x01, 0x02, 0x02, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 0x04, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x04, 0x04, 0x04, 0x04,
    0x01, 0x01, 0x02, 0x02, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 0x04, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x04, 0x04, 0x04, 0x04,
    0x02, 0x02, 0x02, 0x02, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 0x04, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x04, 0x04, 0x04, 0x04,
    0x02, 0x02, 0x02, 0x02, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 0x04, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x04, 0x04, 0x04, 0x04, 0x04,
    0x02, 0x02, 0x02, 0x02, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 0x03, 0x04, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x04, 0x04, 0x04, 0x04, 0x04,
    0x02, 0x02, 0x02, 0x02, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 0x03, 0x04, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x04, 0x04, 0x04, 0x04,
    0x02, 0x02, 0x02, 0x02, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 0x03, 0x04, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x04, 0x04, 0x04, 0x04,
    0x02, 0x02, 0x02, 0x02, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 0x03, 0x04, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x04, 0x04, 0x04, 0x04,
    0x02, 0x02, 0x02, 0x02, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 0x03, 0x04, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x04, 0x04, 0x04, 0x04,
};
// clang-format on

// clang-format off
static const u16 u16_ARRAY_0833d304[4+(HEIGHT * WIDTH)] = {
    5, 31, WIDTH, HEIGHT,
    0xF111, 0xF111, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF110, 0xF110, 0xF110, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100,
    0xF111, 0xF111, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF123, 0x0123, 0x0100, 0x0110, 0x0110, 0x0110, 0x0100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100,
    0xF111, 0xF111, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF123, 0x0123, 0xF100, 0xF100, 0xF100, 0xF100, 0x0100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100,
    0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF110, 0xF110, 0xF110, 0xF113, 0xF103, 0xF100, 0xF100, 0xF100, 0xF123, 0x0123, 0xF100, 0xF100, 0xF100, 0xF100, 0x0100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF123, 0xF123, 0xF123, 0xF100,
    0xF100, 0xF103, 0xF103, 0xF103, 0xF110, 0xF110, 0x0100, 0x0100, 0x0100, 0x0110, 0x0110, 0x0110, 0x0113, 0x0103, 0x0100, 0xF123, 0xF123, 0xF123, 0x0123, 0xF100, 0xF100, 0xF100, 0xC110, 0x0113, 0xF113, 0xF113, 0xF103, 0xF100, 0xF123, 0xE123, 0xE123, 0xF100,
    0xF100, 0xF123, 0x0123, 0x0123, 0x0110, 0x0110, 0x0100, 0x0100, 0x0100, 0x0100, 0xF100, 0xF100, 0xF100, 0xF100, 0x0100, 0x2123, 0x0123, 0x2100, 0x0100, 0xF100, 0xF100, 0xF100, 0xC110, 0x0113, 0x0113, 0x0113, 0x0103, 0x2100, 0x0123, 0x2123, 0x2123, 0xF100,
    0xF100, 0xF123, 0x2123, 0x2123, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xC100, 0xF100, 0xF100, 0xF110, 0x0110, 0x2110, 0xF100, 0xF100, 0xF100, 0xF100,
    0xF100, 0x0100, 0x0100, 0x0100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xC110, 0x0110, 0x1110, 0xC100, 0xF100, 0xF100, 0xF100,
    0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xC100, 0xF100, 0xF100, 0xC100, 0xF100, 0xF100, 0xF100,
    0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xF100, 0xC100, 0xF100, 0xF100, 0xC100, 0xF100, 0xF100, 0xF100,
};
// clang-format on

const struct Stage gRepairFactoryLandscape = {
  id : STAGE_REPAIR_FACTORY,
  fn : sStageRoutine,
  terrainHdr : &gStageTerrains[STAGE_REPAIR_FACTORY],
  maps : {&ScreenMap_0833cdf4, &ScreenMap_0833cf38, &ScreenMap_0833d07c},
  bgIdx : {USE_BG1, USE_BG2, USE_BG3},
  prio : {2, 1, 3},
  screenBase : {BGMAP_BLOCK(2), BGMAP_BLOCK(4), BGMAP_BLOCK(6)},
  scrollPower : {{0x100, 0x100}, {0x100, 0x100}, {0x80, 0x80}},
  scroll : {{0, 0}, {0, 0}, {0, 0}},
  tilesetOffset : sTilesetOffset,
  bgFns : sLayerRoutine,
  behavior : u16_ARRAY_0833d304,
  unk_78 : {-0x155, 0x155},
};

INCASM("asm/stage_gfx/repair_factory.inc");

#undef WIDTH
#undef HEIGHT
